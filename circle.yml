machine:
  environment:
    SERVICE_ACCOUNT: service@haxweb-node.iam.gserviceaccount.com
    ACCT_AUTH: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiaGF4d2ViLW5vZGUiLAogICJwcml2YXRlX2tleV9pZCI6ICJkZGZhYTdjN2RkZjEwZjkxMGE3OWZkOTI4MzllZDA1NGE3NjNmMmU2IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUURVTGF0c085KzNOMWhzXG5sQncvM0UzRDdKNnBTdUhDbkJKTUtzdDBXSklHM0EyRDduUHVNS1FseDd4WU9XdzYwc21uWWxIMlNqNHhSUlI0XG5EZEQvWTdDeEZsbkEwbUtFZlRITnlqakhoSVpGSWdEVkZFTEhraTN6NkhHL1BOTGVpRmdSemlad2toRjI2SGZMXG4yMTF5aWNNWnN5OXlES1dLL0dVaExDb1F0dWwvME9sRWJLOXZFcXlUUFpFb1RkRE5SMGVEL1JuSXd5RTJGa3VGXG5YN1RjNTZJa1I1aEZEbjdQV2lad0s5eEdPN3FHam8vQlNXbUdOdUdSRzdHcmFDbDV1V1RkdkdzNjlwa3AwcTRkXG5tOE5HTmVmbEVPaGtQd0FyZ1pVeUZ6Um9iTmZpSlJGQnJzM0pYK1Z5Uk1CNG0yUVA1QjQxUWtOWnVycHNwa1gyXG55TGw1YWgxL0FnTUJBQUVDZ2dFQVViM0diTXdrUTlGdW4yWHYvQ3BEUzFlOVNEc3cvbWhpSkRYWWE5b3paN0VmXG5BOVM1bE9ub1V5Vy95YjFWbE5QZ0hEd2tsMTNDMS9obENsdElTUnQrMXJwbG1ZTnpzTmNLZU4yUFFrNHI3RFpOXG5XOG1TY0pCQVk5Y0krMFBUZVNmTnhnNUZnTmpGSWFvdGZMdm1KRm91YjVnNGp4ZVFMeHROV3BwSkdtZGRUWC9hXG5BSnl4MmZhZ2VlQ1BvSG0vbjV1cFRwOXN0RUtQcEtibWxFWUJwRFVkbDY3WkdpTU91d1FnWTBhMVl3TGNhckRsXG5aRE9UVDVZZy9Hc1A3TXJ6emJWZlpUcWYzRXg0bnJpeXY2d05DMDFuZ2dwemdUZUVXSHMwWkFZUlM2OFRybFF2XG5HMmNpZVZyOURNRStGbGFLakNhY1JvODZwalpnU2ttTFdnaTMvcDJLQVFLQmdRRC85MUUzVGpNZktra3dodGloXG44OTMwb1NubWxhQmptSjFXQ3RabmhxZG14RzBPNVFpN203S1crbDVVaVBQeDV1Y01BbytHb0JqOC85dm45c3lxXG5RbzE3SStuNXkrOEEwYytiN2daUTc5Rm12RXcwcEs3cXNpMVg3TkRuTUNVWW1td0dZQjNlUVBVL3dOWWRIOUI3XG4yNENPWDRsR2RXWTlpQmFUcXc1MzVUV2wxd0tCZ1FEVU5OMzFkeGdRcGtSc1RRQ3pTLzU4VUJSMjBBVXMxUTBmXG50U0xmNDg5TkZ3eFZYc043Zys0RDNlSUxzbFBMYUFsV3dXU2ptTXljQmtIdkdlUXJsRExyRkJVN0JDZ25VVmpnXG5TOUwzSVR5NndidG1GVzd1czJtRjlUQll1SEJQc1JmUHE4MzB1Q05jNzJ2dXRRNFB3dnBaMXpwdmlLaklLVDlWXG55YjFSWnpZQW1RS0JnUUN3WFZRVWEwbEdHL2k1K3UraEIwclRsNGdyWE1WYVdubHVJNkYvUzRSa2hzc3VEQmxzXG5TdWRPcDh2L0t5NEthektmVDlSY3lrcnRaODI1a28rS2NMalRNL2V2S2hqUDA4RGNpN0RHYTdjNHRsMDdtSXo5XG5JUytrK1lNbkNFRkhKbjl3RlNIL1ZYcW1KdFJnMU43dHVGeG52T1AxTEViNTlwNjN1SkVMZzE3bm1RS0JnRlczXG5KUkRKa2tibllpdjh6cE9kMXFXUUV6UUt3b3hoWW5PMFR1bndzd09JazhySUJGNFg1RVJiazdyMXhUTWNTdWxvXG5KS2FRU2RXY0VYWHJGMmNpN1k1WEJseFlTWC9ZTS9ZbHFvbDRPM2VVV1lYYWtueUlxODhZUXZjVFNRcG5saDZrXG5Yd1RDZkVaRnoyc1VaeUdtdUVraHp0RE9lcDZmU3AzMFp5eENiR1hCQW9HQVBOU2JMb1prNDdTWFdCR3J3WHdDXG4rL2E3NmNwM1lnclFXYVJmSXpXeTh4ZnB4STdGeER2VVhnWjMyUkFmczJGWEpBZjhDdmxTZ3pkWDYrVmpqZ1BFXG5TaFQ1TXNxQmhJTHZnenE3ZnF3TnV5RnB0Mmd0MlRzajA5WlhsSzA0L0hIWTRJRTNZbXRYeWYrT1hySTVnWXVLXG5zdHpIa3NZN0p0OWtvZE9BQWl2YUtFZz1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJzZXJ2aWNlQGhheHdlYi1ub2RlLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwMDE2MTkyMjQyODE1Nzk3NjAxNiIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L3NlcnZpY2UlNDBoYXh3ZWItbm9kZS5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo=
    APP_NAME: haxweb-node-api
    DOCKER_IMAGE: demo-node
    PROJECT_NAME: haxweb-node
    CLUSTER_NAME: haxweb-node
    CLOUDSDK_CORE_DISABLE_PROMPTS: 1
    CLOUDSDK_PYTHON_SITEPACKAGES: 1
    CLOUDSDK_INSTALL_DIR: /tmp
    GOOGLE_APPLICATION_CREDENTIALS: /home/ubuntu/account-auth.json
    CLOUDSDK_COMPUTE_ZONE: europe-west1-c
    DEBIAN_FRONTEND: noninteractive
    CLOUDSDK_PYTHON: python2.7
  services:
    - docker
deployment:
  prod:
    branch: master
    commands:
      - echo ${ACCT_AUTH} | base64 -d > /home/ubuntu/account-auth.json
      - sudo apt-get remove python-virtualenv python-openssl python3-openssl
      - sudo apt-get update
      - sudo apt-get install python-openssl python3-openssl
      - deploy/gcloud-install --sdk-home ${CLOUDSDK_INSTALL_DIR} --key-file /home/ubuntu/account-auth.json --account ${SERVICE_ACCOUNT} --cluster ${CLUSTER_NAME} --project ${PROJECT_NAME}
      - deploy/deploy.sh
