machine:
  environment:
    SERVICE_ACCOUNT: service@haxweb-node.iam.gserviceaccount.com
    ACCT_AUTH: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiaGF4d2ViLW5vZGUiLAogICJwcml2YXRlX2tleV9pZCI6ICI2NDU0NGUyNTliYjVmZjU1ZmU0ZDM4ZmU2YWI4NTlhMmQ1M2QxNTM4IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURZMmQrNmwySUlsWWJPXG4yMmxnMUZjYUFZNnlhWTZxQ1hOODRtdzJBUy9iWHdLczBQc3cvNVFuQWRjNlFJTTV1b0RXZ3hMeHFKMUlzb0hlXG42KzZEUHNuTU13dTVKaHdZanM5OU05M1kvZzVML3dOdEczaHBLZGx3dUluV3c1WUk2TWkxNEM5d3ZVWlRneFE1XG5sbkJzV1RhU3ZNNGlhSytFY0hNWGZ0ZmR4ZTkyUTB4RDZ1VXNGRFZhSXFYdFdrelVydEhBSTdJc0JiVE5Fd2M1XG5EaWJpbmtCVS8rRytZVE9yb0NJelA0cVNxTXQ5ZU1SazF3TTVqSFFyRElrN3JCZlFyYWpZTVArbXJLMzhRMGZTXG5sNTNJNlNHSms2Z21OV2pZUXNVOUVxQ2tHai9hakdWcGVtbXN3MGprUEk4UjBiYkVWYjFBNHFGbUZBNE5XTWpBXG5pakFtelVOekFnTUJBQUVDZ2dFQVp3bC9TUVhOU3c3aGMwREdIWUJIc3MreW9ndU9BalZqYnArWGswR1ZIOE5SXG5YaFFlaHZXcHk2OFFPVm1XQU1RaG04dkVJSmRoeEwwdEFHTlNmWUpFR0liWXR5em9oTEsyM0dMY3N0SmtzSytIXG5UVHlVUmtQZ1ViTWRxN0piZy9nNEJsTnp0em40Ukk0ditmMEZoallOdkVPQ0hzOW5OcUxIelE0ME8raGxFK2VkXG5tcTBMTEhsd3oyRW92cE1BOGVMSGhyeWpZNXZXb3RIemQ2WUVFUkxUVEIvb245WExxVWkzZC9tZlBha1dZL0FZXG5uSlg3S0FFTWV0a040TGdIL3VncFdYaXlUNnZTeFY3bExqQnZKbFd3cnAvTSsxME9VR1JERjRTQS8rTjZhRGhIXG4xUUxQOVRVTXZFNzR6cXBqN3B6MS9mWnZEZVBNQU1Ya3NRbGExallxb1FLQmdRRC9tNTR2c2M0QUcrVEdaQXZzXG5TWEZOK25GYWVZM3BSTXoxcWxwZzRMQ2lIOHhqUE5pRkl0M1lwMHFZQWtQNUFCM1BHNXRSV3JtaWRna005SmdmXG50SnBWcXRZQkxvQ1Q2bGNzRzlPL0NKOHJzVkx2V0lLN3QySmJISDVXMzFSN1FzcU85ZTIxRmpzOVNoZWhFUW5UXG5leEkvTTVLcjhKOElVS25OblE0SXhBc3dUUUtCZ1FEWkx3a1ZydG11V09Ucjc0czNUT1Vja2hGYjcrYXhpRVRWXG5STE9jaEFhQ0NQcWh5dGhEdkVCMHdCR1FGVVk5YTFDSGpDRmJaeGVUT3BNbUNyaDdENzRuWlQyeVJsWDV4TEtTXG4xOFJpb0FYbUtCY3haU1ROVDBtTVZBTkVQYTZodlE3aVIyWGNtMzBVUFVodldyRUxqMzc1WC9xRXV3eHZ2K1A2XG5RbkhVVXpJaXZ3S0JnQkNuWlFFYWhwOS9NY0t6Vmd1SkpYYTlNSkdDaGZxQzN3L0tqNlRzUHRYeFdISEd6eHl0XG5qdUxFMDVsZjNHbm0xZ3BlZEJveTNSRjJ1MVE2dzRhZFQ4anhIb3hwS1R0NTgwQU9lQmRrU21xZ1hSVDNJVjExXG5yMVRjWUdic21pYUZ6WWpQQVRQaFJPN1RXd0xGaDJ4ZUFteFh3ZUN1QnM2VjR0cGd0ejllOXBPcEFvR0JBSWhKXG5zZU8vYzY2cTdnejRwMTR1ak4vZThiSEYyL2l3VUxHY2lUSEF6K3l1QWNtaDV4Q3FnN0JBRDBWaGRGQjZsWEJhXG5DVnk0VnR6M052djZZa1luWE9hUDY2V0I2ZFh4RHphQzNDUWYwMVBZK0tUd21hV1ZDY3hidENrUXBCT3U5allkXG5JOWpLWWpWZk42TlpRQnpIRWFFZ0Q2OVhTYmllckV1Umdxa0JCRWMxQW9HQkFNUVl1cjc0czdEa0dsUGl2YW9hXG5vV1UzQ3RPTlRHS1BVcVhTdHN1UkMxU3k0MVpQeGRwc2crV2Q0YjE0T0dLODNwVGV0LzFHbHMreHpYbjVwVnhmXG5PNm1XSkdZaDdQOUg5Y0hUbUt0T3gyTHA0RDdENTBuWklSVk9tT2ttQllpMmNGZlFkNFNhUTRUY3N6dklwVVNIXG41V0NBZnNrejdydFAvTWVzMWFMVXl5bGFcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJzZXJ2aWNlQGhheHdlYi1ub2RlLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwMjU1NDgwODgwNjk2NzM5ODg0MiIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L3NlcnZpY2UlNDBoYXh3ZWItbm9kZS5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo=
    APP_NAME: haxweb-node-api
    DOCKER_IMAGE: haxweb-node
    PROJECT_NAME: haxweb-node
    CLUSTER_NAME: haxweb-node
    CLOUDSDK_CORE_DISABLE_PROMPTS: 1
    CLOUDSDK_PYTHON_SITEPACKAGES: 1
    CLOUDSDK_INSTALL_DIR: /tmp
    GOOGLE_APPLICATION_CREDENTIALS: /home/ubuntu/account-auth.json
    CLOUDSDK_COMPUTE_ZONE: europe-west1-c
    DEBIAN_FRONTEND: noninteractive
    CLOUDSDK_PYTHON: python2.7
  services:
    - docker
deployment:
  prod:
    branch: master
    commands:
      - echo ${ACCT_AUTH} | base64 -d > /home/ubuntu/account-auth.json
      - sudo apt-get remove python-virtualenv python-openssl python3-openssl
      - sudo apt-get update
      - sudo apt-get install python-openssl python3-openssl
      - deploy/gcloud-install --sdk-home ${CLOUDSDK_INSTALL_DIR} --key-file /home/ubuntu/account-auth.json --account ${SERVICE_ACCOUNT} --cluster ${CLUSTER_NAME} --project ${PROJECT_NAME}
      - deploy/deploy.sh
